
R Under development (unstable) (2024-11-21 r87360) -- "Unsuffered Consequences"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> # This file is part of the standard setup for testthat.
> # It is recommended that you do not modify it.
> #
> # Where should you do additional test configuration?
> # Learn more about the roles of various files in:
> # * https://r-pkgs.org/testing-design.html#sec-tests-files-overview
> # * https://testthat.r-lib.org/articles/special-files.html
> 
> library(testthat)
> library(eva3dm)
> 
> test_check("eva3dm")
calculating wind speed ...
calculating wind direction...
VVIbes has only 0 valid observations (lesser than 8 obs)
Ibirapuera not found in observation input
Americana has 227 valid observations
using 0 for min cutoff
227 values left
using 999 for max cutoff
227 values left
using 0 for min NME cutoff
227 values left
using 935 for max NME cutoff
227 values left
Terradonunca not found in observation input
Americana not found in model input
zeros contains only zeros (or constant values) and NA values for model
zeros contains only zeros (or constant values) and NA values for observations
zeros contains only zeros (or constant values) and NA values for observations
combining all sites...
considering a fair comparison for other domain...
Americana  SAndre  VVIbes  zero  zeros  ...
ALL has 914 valid observations
combining all sites...
considering a fair comparison for other domain...
Americana  SAndre  VVIbes  zero  zeros  ...
ALL has 914 valid observations
using model in obs 
combining all sites...
Americana  SAndre  VVIbes  zero  zeros  ...
ALL has 914 valid observations
using model in names(obs) 
combining all sites...
Americana  SAndre  VVIbes  zero  zeros  ...
ALL has 914 valid observations
                         n      Obs       Sim          r       IOA        FA2
VVIbes                   0       NA        NA         NA        NA         NA
Ibirapuera               0       NA        NA         NA        NA         NA
am 2                   227 440.9295 378.18197  0.6492022 0.4366783 1.00000000
Terradonunca             0       NA        NA         NA        NA         NA
Americana                0       NA        NA         NA        NA         NA
model zero               0       NA        NA         NA        NA         NA
obs zero                 0       NA        NA         NA        NA         NA
obs cke                  0       NA        NA         NA        NA         NA
all fair               914 155.6685  39.70511 -0.3543786 0.3421893 0.03829322
all fair 2             914 155.6685  39.70511 -0.3543786 0.3421893 0.03829322
all model in obs       914 155.6685  39.70511 -0.3543786 0.3421893 0.03829322
all names model in obs 914 155.6685  39.70511 -0.3543786 0.3421893 0.03829322
                            RMSE         MB        ME   NMB (%)   NME (%)
VVIbes                        NA         NA        NA        NA        NA
Ibirapuera                    NA         NA        NA        NA        NA
am 2                    66.89005  -62.74754  62.74754 -14.23074  14.23074
Terradonunca                  NA         NA        NA        NA        NA
Americana                     NA         NA        NA        NA        NA
model zero                    NA         NA        NA        NA        NA
obs zero                      NA         NA        NA        NA        NA
obs cke                       NA         NA        NA        NA        NA
all fair               235.09955 -115.96338 177.83271 -74.49381 114.23809
all fair 2             235.09955 -115.96338 177.83271 -74.49381 114.23809
all model in obs       235.09955 -115.96338 177.83271 -74.49381 114.23809
all names model in obs 235.09955 -115.96338 177.83271 -74.49381 114.23809
Americana has 227 valid observations
SAndre has 207 valid observations
VVIbes has only 0 valid observations (lesser than 8 obs)
georeferencing stats at sites 
extracting series of o3 field 4d for 2 points
dim of lat/lon: 125 125 
used dim of lat/lon: 125 125 
inside lat / lon range: 2 points
calculating distances...
extracting series of o3 field 4d for 2 points
dim of lat/lon: 125 125 
used dim of lat/lon: 125 125 
using i & j to extract points:
             lat       lon    name agency            class         city state
BA0001 -12.68638 -38.33360 Gravatá  INEMA Não classificada     Camaçari    BA
BA0002 -12.63026 -38.35853   Cobre  INEMA Não classificada Dias D'Ávila    BA
       start   i  j model_lat model_lon
BA0001  2000 110 67 -12.70324 -38.39191
BA0002  2000 110 67 -12.70324 -38.39191
reading o3 : /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/wrf.day1.o3.nc file 1 of 3 
reading o3 : /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/wrf.day2.o3.nc file 2 of 3 
reading o3 : /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/wrf.day3.o3.nc file 3 of 3 
output: /var/scratch2/tomas/tmp/Rtmp5ol804/SERIE/serie.o3.Rds 
extracting series of o3 field 4d for 5 points
dim of lat/lon: 125 125 
used dim of lat/lon: 125 125 
inside lat / lon range: 5 points
calculating distances...
* station Gravatá ouside the domain
* station Cobre ouside the domain
* station Areias ouside the domain
* station Lamarão ouside the domain
             lon       lat   i  j model_lat model_lon
Escola -38.27318 -12.63532 110 67 -12.70324 -38.39191
reading o3 : /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/wrf.day1.o3.nc file 1 of 3 
reading o3 : /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/wrf.day2.o3.nc file 2 of 3 
reading o3 : /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/wrf.day3.o3.nc file 3 of 3 
output: /var/scratch2/tomas/tmp/Rtmp5ol804/SERIE/serie.o3.Rds 
extracting series of o3 field 4d for 5 points
dim of lat/lon: 125 125 
used dim of lat/lon: 125 125 
inside lat / lon range: 5 points
calculating distances...
* station Gravatá ouside the domain
* station Cobre ouside the domain
* station Areias ouside the domain
* station Lamarão ouside the domain
             lon       lat   i  j model_lat model_lon
Escola -38.27318 -12.63532 110 67 -12.70324 -38.39191
reading o3 : /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/wrf.day1.o3.nc file 1 of 3 
reading o3 : /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/wrf.day2.o3.nc file 2 of 3 
reading o3 : /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/wrf.day3.o3.nc file 3 of 3 
output: /var/scratch2/tomas/tmp/Rtmp5ol804/SERIE/serie.o3.Rds 
extracting mean of o3 field 4d 
reading: /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/wrf.day1.o3.nc file 1 of 1 
min: 2.123069e-05 mean: 0.007767247 max: 0.03175572 
total times: 1 
output: /var/scratch2/tomas/tmp/Rtmp5ol804/MEAN/mean.o3.nc 
extracting 8h max of o3 field 3d units: ug m-3 
reading: /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/test_small_o3.nc file 1 of 1 
min: 2.010639e-13 mean: 23.42075 max: 99.85495 
total times: 24 
output: /var/scratch2/tomas/tmp/Rtmp5ol804/MDA8/mean.o3.nc 
terra 1.7.83

Attaching package: 'terra'

The following objects are masked from 'package:testthat':

    compare, describe

writing XLAT in /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/wrfinput_d01
Error in R_nc4_open: Read-only file system
[1] "Error in nc_open trying to open file /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/wrfinput_d01 (setting rv$error TRUE and returning because return_on_error==TRUE)"
reading /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/sat_cat.csv 
reading /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/sat_cat.txt 
writing /var/scratch2/tomas/tmp/Rtmp5ol804/s/sat_cat.csv 
writing /var/scratch2/tomas/tmp/Rtmp5ol804/s/sat_cat.txt 
croping m with o 
removing 6 points for the model (y) boundaryes ...
interpolating obs. (x) to model grid (y)...
removing 6 points for the model (y) boundaryes ...
interpolating obs. (x) to model grid (y)...
seting min value to 2 
seting max value to 110 
using 0.05 for min cutoff
97 values left
using 3 for max cutoff
97 values left
 folder  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/WRF/case : link wrf output files here!
 bash  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/post-R_wrf.sh : post processing job script
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/extract_metar.R : source code to extract metar using eva3dm::extract_serie()
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/extract_inpet.R : source code to extract inmet using eva3dm::extract_serie()
 folder  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/WRF/case : link wrf output files here!
 bash  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/post-R_wrf.sh : post processing job script
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/extract_metar.R : source code to extract metar using eva3dm::extract_serie()
 folder  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/CAMx/case : link CAMx output files here!
 bash  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/post-R_CAMx.sh : post processing job script
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/extract_camx.R : source code to extract time-series from AERONET site locations using eva3dm::extract_serie()
 folder  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/CAMx/case : link CAMx output files here!
 bash  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/post-R_CAMx.sh : post processing job script
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/extract_camx.R : source code to extract time-series from AERONET site locations using eva3dm::extract_serie()
 folder  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/WRF/case : link wrf output files here!
 bash  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/post-R_wrfchem.sh : post processing job script
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/extract_metar.R : source code to extract metar using eva3dm::extract_serie()
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/extract_aq.R : source code to extract AQ stations from Brazil using eva3dm::extract_serie()
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/extract_pm.R : source code to extract PM compositon from AERONET sites using eva3dm::extract_serie()
 folder  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/WRF/case : link wrf output files here!
 bash  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/post-R_exp.sh : post processing job script
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/extract_expr.R : source code to extract metar using eva3dm::extract_serie()
 new locations can be added to the data.frame with the list of sites.
 folder  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/ : copy wrfinput_d01 gere!
 folder  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/METAR : destination folder
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/download_METAR.R : script that download metar data using riem package and information from eva3dm and wrfinput_d01 file
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/all_tables.R : setup and run script
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/table_metar_T2.R : evaluation of Temperature using METAR
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/table_metar_Q2.R : evaluation of absolute humidity using METAR
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/table_metar_WS.R : evaluation of wind speed using METAR
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/table_metar_WD.R : evaluation of wind direction using METAR
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/all_tables.R : setup and run script
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/table_metar_T2.R : evaluation of Temperature using METAR
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/table_metar_Q2.R : evaluation of absolute humidity using METAR
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/table_metar_WS.R : evaluation of wind speed using METAR
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/table_metar_WD.R : evaluation of wind direction using METAR
 folder  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/WRF/case : link WRF or CAMx post-rocessed output here!
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/all_tables.R : setup and run script
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/table_aq_o3.R : evaluation of hourly 8h O3
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/table_aq_max_o3.R : evaluation of daily max 8h O3
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/table_aq_pm2.5.R : evaluation of daily pm2.5
 NOTE 1: Other scripts in all_tables.R not provided, use previous as template
 NOTE 2: other templates provide templates for metar
 folder  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/WRF/case : copy wrf post-proced files here!
 folder  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/GPCP : folder to copy satellite data here!
 r-script /var/scratch2/tomas/tmp/Rtmp5ol804/POST/table_GPCP_rain.R : script for satellite evaluation (CHANGE the file names!!)
 bash  /var/scratch2/tomas/tmp/Rtmp5ol804/POST/post-sate.sh : post processing for satellite evaluation using CDO
processing hourly data ... 
processing 8-hour moving avarage ... 
processing daily maximum ... 
processing hourly data ... 
processing 8-hour moving avarage ... 
processing hourly data ... 
processing daily statistcis ... 
File /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/wrfinput_d01 (NC_FORMAT_CLASSIC):

     3 variables (excluding dimension variables):
        char Times[DateStrLen,Time]   
        float XLAT[west_east,south_north]   
            MemoryOrder: XY
            description: LATITUDE, SOUTH IS NEGATIVE
            units: degree north
            stagger: 
            FieldType: 104
        float XLONG[west_east,south_north]   
            MemoryOrder: XY
            description: LONGITUDE, WEST IS NEGATIVE
            units: degree east
            stagger: 
            FieldType: 104

     4 dimensions:
        DateStrLen  Size:19 
        Time  Size:1   *** is unlimited *** 
        west_east  Size:149 
        south_north  Size:99 

    79 global attributes:
        TITLE:  OUTPUT FROM REAL_EM V3.9.1.1 PREPROCESSOR
        START_DATE: 2011-08-01_00:00:00
        SIMULATION_START_DATE: 2011-08-01_00:00:00
        WEST-EAST_GRID_DIMENSION: 150
        SOUTH-NORTH_GRID_DIMENSION: 100
        BOTTOM-TOP_GRID_DIMENSION: 35
        DX: 9000
        DY: 9000
        GRIDTYPE: C
        DIFF_OPT: 1
        KM_OPT: 4
        DAMP_OPT: 3
        DAMPCOEF: 0.200000002980232
        KHDIF: 0
        KVDIF: 0
        MP_PHYSICS: 10
        RA_LW_PHYSICS: 4
        RA_SW_PHYSICS: 4
        SF_SFCLAY_PHYSICS: 1
        SF_SURFACE_PHYSICS: 2
        BL_PBL_PHYSICS: 1
        CU_PHYSICS: 11
        SF_LAKE_PHYSICS: 0
        SURFACE_INPUT_SOURCE: 1
        SST_UPDATE: 0
        GRID_FDDA: 0
        GFDDA_INTERVAL_M: 0
        GFDDA_END_H: 0
        GRID_SFDDA: 0
        SGFDDA_INTERVAL_M: 0
        SGFDDA_END_H: 0
        HYPSOMETRIC_OPT: 2
        USE_THETA_M: 0
        USE_MAXW_LEVEL: 0
        USE_TROP_LEVEL: 0
        GWD_OPT: 0
        SF_URBAN_PHYSICS: 1
        SF_OCEAN_PHYSICS: 0
        SIMULATION_INITIALIZATION_TYPE: REAL-DATA CASE
        WEST-EAST_PATCH_START_UNSTAG: 1
        WEST-EAST_PATCH_END_UNSTAG: 149
        WEST-EAST_PATCH_START_STAG: 1
        WEST-EAST_PATCH_END_STAG: 150
        SOUTH-NORTH_PATCH_START_UNSTAG: 1
        SOUTH-NORTH_PATCH_END_UNSTAG: 99
        SOUTH-NORTH_PATCH_START_STAG: 1
        SOUTH-NORTH_PATCH_END_STAG: 100
        BOTTOM-TOP_PATCH_START_UNSTAG: 1
        BOTTOM-TOP_PATCH_END_UNSTAG: 34
        BOTTOM-TOP_PATCH_START_STAG: 1
        BOTTOM-TOP_PATCH_END_STAG: 35
        GRID_ID: 1
        PARENT_ID: 1
        I_PARENT_START: 1
        J_PARENT_START: 1
        PARENT_GRID_RATIO: 1
        DT: 45
        CEN_LAT: -23.5499954223633
        CEN_LON: -45
        TRUELAT1: -23
        TRUELAT2: -24
        MOAD_CEN_LAT: -23.5499954223633
        STAND_LON: -45
        POLE_LAT: 90
        POLE_LON: 0
        GMT: 0
        JULYR: 2011
        JULDAY: 213
        MAP_PROJ: 1
        MAP_PROJ_CHAR: Lambert Conformal
        MMINLU: MODIFIED_IGBP_MODIS_NOAH
        NUM_LAND_CAT: 21
        ISWATER: 17
        ISLAKE: 21
        ISICE: 15
        ISURBAN: 13
        ISOILWATER: 14
        HYBRID_OPT: -1
        ETAC: 0
global attributes:
TITLE START_DATE SIMULATION_START_DATE WEST-EAST_GRID_DIMENSION SOUTH-NORTH_GRID_DIMENSION BOTTOM-TOP_GRID_DIMENSION DX DY GRIDTYPE DIFF_OPT KM_OPT DAMP_OPT DAMPCOEF KHDIF KVDIF MP_PHYSICS RA_LW_PHYSICS RA_SW_PHYSICS SF_SFCLAY_PHYSICS SF_SURFACE_PHYSICS BL_PBL_PHYSICS CU_PHYSICS SF_LAKE_PHYSICS SURFACE_INPUT_SOURCE SST_UPDATE GRID_FDDA GFDDA_INTERVAL_M GFDDA_END_H GRID_SFDDA SGFDDA_INTERVAL_M SGFDDA_END_H HYPSOMETRIC_OPT USE_THETA_M USE_MAXW_LEVEL USE_TROP_LEVEL GWD_OPT SF_URBAN_PHYSICS SF_OCEAN_PHYSICS SIMULATION_INITIALIZATION_TYPE WEST-EAST_PATCH_START_UNSTAG WEST-EAST_PATCH_END_UNSTAG WEST-EAST_PATCH_START_STAG WEST-EAST_PATCH_END_STAG SOUTH-NORTH_PATCH_START_UNSTAG SOUTH-NORTH_PATCH_END_UNSTAG SOUTH-NORTH_PATCH_START_STAG SOUTH-NORTH_PATCH_END_STAG BOTTOM-TOP_PATCH_START_UNSTAG BOTTOM-TOP_PATCH_END_UNSTAG BOTTOM-TOP_PATCH_START_STAG BOTTOM-TOP_PATCH_END_STAG GRID_ID PARENT_ID I_PARENT_START J_PARENT_START PARENT_GRID_RATIO DT CEN_LAT CEN_LON TRUELAT1 TRUELAT2 MOAD_CEN_LAT STAND_LON POLE_LAT POLE_LON GMT JULYR JULDAY MAP_PROJ MAP_PROJ_CHAR MMINLU NUM_LAND_CAT ISWATER ISLAKE ISICE ISURBAN ISOILWATER HYBRID_OPT ETACvariable Times attritutes:
not found
XLAT attribute units:
degree north
global attribute DT:
45
Error in R_nc4_open: Read-only file system
[ FAIL 3 | WARN 0 | SKIP 0 | PASS 6 ]

══ Failed tests ════════════════════════════════════════════════════════════════
── Error ('test-rast.R:9:3'): rast based functions are ok ──────────────────────
Error in `ncdf4::ncatt_get(nc = neto, varid = name, attname = "MemoryOrder")`: Error, first passed argument must be an object of class ncdf4
Backtrace:
    ▆
 1. └─eva3dm::rast_to_netcdf(r = r, file = wrf, name = "XLAT") at test-rast.R:9:3
 2.   └─ncdf4::ncatt_get(nc = neto, varid = name, attname = "MemoryOrder")
── Error ('test-utils.R:11:3'): utility functios are functional! ───────────────
Error in `ncdf4::nc_open(filename = file, write = to_write)`: Error in nc_open trying to open file /var/scratch2ro/tomas/cran/rlibro/lib/eva3dm/extdata/wrfinput_d01 (return_on_error= FALSE )
Backtrace:
    ▆
 1. └─eva3dm::atr(...) at test-utils.R:11:3
 2.   └─ncdf4::nc_open(filename = file, write = to_write)
── Error ('test-utils.R:11:3'): utility functios are functional! ───────────────
Error in `if (nc$safemode) {
    return()
}`: argument is of length zero
Backtrace:
    ▆
 1. └─eva3dm::atr(...) at test-utils.R:11:3
 2.   └─ncdf4::nc_close(meta) at test-utils.R:11:3

[ FAIL 3 | WARN 0 | SKIP 0 | PASS 6 ]
Error: Test failures
Execution halted
